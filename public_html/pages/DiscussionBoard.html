<!-- Name: Junji Duan   e-mail: junji.duan@mail.mcgill.ca -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discussion Board</title>
    <link href="../cgi_bin/bootstrap/bootstrap.min.css" rel="stylesheet">
    
    <style>

        body {
            font-family: Arial, sans-serif;
        }

         /* Adjust row to work inside a flex container */
         .row {
            display: flex;
            flex-grow: 1; /* Allow row to grow and fill space */
        }
    
        .container-fluid {
            display: flex;
            min-height: 100vh;
        }
    
        .sidebar {
            flex: 0 0 200px;
            min-height: 100vh;
            background-color: #f8f9fa; /* Light grey background */
            padding: 10px;
            box-shadow: 2px 0px 5px rgba(0,0,0,0.1);
        }
    
        .sidebar a, .sidebar div {
            /* display: block; */
            padding: 8px 10px;
            margin: 5px 0;
            color: #333;
            text-decoration: none;
        }
    
        .sidebar a:hover, .sidebar div:hover {
            background-color: #e9ecef; /* Light hover effect */
        }

        .mycourses-link{
            text-align: center;
        }

    
        .search-box {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            margin-bottom: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            align-items: center;
        }

        .make-post {
            font-weight: bold;
            color: #007bff; /* Bootstrap primary color */
        }

        .manage-system {
            font-weight: bold;
            color: #007bff; /* Bootstrap primary color */
        }
    
        .content-area {
            padding: 20px;
            background-color: #fff;
            border-left: 1px solid #ced4da;
            min-height: 100vh; 
        }
    
        .post-list {
            list-style-type: none;
            padding: 0;
        }
    
        .post-list div {
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            padding: 10px;
        }
    
        .post-list div:hover {
            background-color: #f5f5f5;
        }

        .welcome {
            position: relative; /* Allows absolute positioning of children */
            display: block;
            background-image: url(../asserts/images/welcome2.jpg);
            min-height: 95vh;
            background-size: cover;
            position: relative; 
            padding: 20px; 
            margin-top: 22px; /* Adds 20px space above the welcome section */
        }

        .welcome-text {
            font-weight: bold;
            text-align: center;
            color: white;
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .spacer {
            height: 100px; 
        }

        .manage-board-member, .manage-channels, .manage-channel-members {
            position: absolute;
            padding: 8px 12px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .manage-channels {
            top: 160px;
            left: 430px;  /*Position at lower-left corner */
        }

        .manage-board-member {
            top: 160px;
            right: 430px; /* Position at lower-right corner */
        }

        .manage-channel-members {
            bottom: 160px;
            right: 430px; /* Position at lower-right corner */
        }

        .comment-section {
            margin-top: 20px;
        }

        #commentText {
            margin-bottom: 10px;
        }

    </style>

</head>

<body>
    <div class="container-fluid">
        <!-- Main row for sidebar and content area -->
        <div class="row">

            <!-- Left Sidebar -->
            <div class="col-md-2 sidebar">
                <!-- Navigation and utility links in sidebar -->
                <a href="SelectBoard.html" class="mycourses-link"><b>My Courses</b></a>
                <div class="make-post" id="makepost">Make a Post</div>
                <div class="manage-system" id="managesystem">Manage System</div>
                <input type="text" class="form-control search-box" placeholder="Search posts...">
                <!-- List where posts will be dynamically added -->
                <div class="post-list"></div>
            </div>

            <!-- Right Content Area -->
            <div class="col-md-10" id="contentArea">
                <!-- Area where the content of posts will be displayed -->
                <div id="postDisplayArea"></div>

                <!-- 'Make a Post' Form -->
                <div id="makepostSection" style="display: none;">
                    <input type="text" class="form-control" id="postTitle" placeholder="Post Title" style="margin-bottom: 10px;">
                    <textarea class="form-control" id="postContent" rows="4" placeholder="Post Content" style="margin-bottom: 10px;"></textarea>
                    <select class="form-control" id="postVisibility" style="margin-bottom: 10px;">
                        <option value="private">Private</option>
                        <option value="public">Public</option>
                    </select>
                    <button class="btn btn-primary" id="submitPost">Post</button>
                </div>

            </div>

        </div>
    </div>

    <!-- Including Bootstrap JavaScript for functionality -->
    <script src="../cgi_bin/bootstrap/jquery.min.js"></script>
    <script src="../cgi_bin/bootstrap/popper.min.js"></script>
    <script src="../cgi_bin/bootstrap/bootstrap.min.js"></script>

    <script>

        // Dummy data for posts (used for demonstration purposes)
        const posts = [
            { title: "Post 1", content: "Content for Post 1" },
            { title: "Post 2", content: "Content for Post 2" },
            { title: "Post 3", content: "Content for Post 3" },
            { title: "Post 4", content: "Content for Post 1" },
            { title: "Post 5", content: "Content for Post 2" },
            { title: "Post 6", content: "Content for Post 3" },
            // Add more post data as needed
        ];

        // Function to extract URL parameters (e.g., 'course' from the query string)
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }
        
        // Logic specific to handling course-related features
        function handleCourseSpecificLogic() {

            const courseName = getUrlParameter('course');
            if (courseName) {
                
                // Create a new element for the welcome section
                const welcomeSection = document.createElement('div');
                welcomeSection.id = 'welcomeSection';
                welcomeSection.className = 'welcome';

                // Add a spacer div to adjust the height
                const spacerDiv = document.createElement('div');
                spacerDiv.className = 'spacer';
                welcomeSection.appendChild(spacerDiv);

                // Create an inner text container
                const welcomeTextDiv = document.createElement('div');
                welcomeTextDiv.className = 'welcome-text';

                // Add welcome message and course name
                // <h1>Discussion Board for ${courseName}</h1>
                welcomeTextDiv.innerHTML = `
                <h1>Discussion Board for ${courseName}</h1>
                `;

                // Append the text container to the welcome section
                welcomeSection.appendChild(welcomeTextDiv);

                // Add the welcome section to the content area
                const contentArea = document.getElementById('contentArea');
                contentArea.prepend(welcomeSection);

                // Create Manage Board Members button
                const manageBoardMemberButton = document.createElement('div');
                manageBoardMemberButton.className = 'manage-board-member';
                manageBoardMemberButton.id = 'manageBoardMember';
                manageBoardMemberButton.textContent = 'Manage Board Members';
        
                // Create Manage Channels button
                const manageChannelsButton = document.createElement('div');
                manageChannelsButton.className = 'manage-channels';
                manageChannelsButton.id = 'manageChannels';
                manageChannelsButton.textContent = 'Manage Channels';

                // Create Manage Channel Members button
                const manageChannelMembersButton = document.createElement('div');
                manageChannelMembersButton.className = 'manage-channel-members';
                manageChannelMembersButton.id = 'manageChannelMembers';
                manageChannelMembersButton.textContent = 'Manage Channel Members';

                // Append buttons to the welcome section
                welcomeSection.appendChild(manageBoardMemberButton);
                welcomeSection.appendChild(manageChannelsButton);
                welcomeSection.appendChild(manageChannelMembersButton); 

            }

        }
        
        // Event listener for 'Manage System' button click
        document.getElementById('managesystem').addEventListener('click', function() {
            const welcomeSection = document.getElementById('welcomeSection');
            welcomeSection.style.display = 'block'; // Show the welcome section

            // Clear the previously displayed post content
            const postDisplayArea = document.getElementById('postDisplayArea');
                postDisplayArea.innerHTML = '';

            // Hide 'Make a Post' form section
            const makepostSection = document.getElementById('makepostSection');
            if (makepostSection) {
                makepostSection.style.display = 'none';
            }

        });
        
        // Display make a post page
        document.addEventListener('DOMContentLoaded', function() {
        handleCourseSpecificLogic();

            // Event listener for 'Make a Post'
            document.getElementById('makepost').addEventListener('click', function() {
                
                // Hide welcome section
                if (welcomeSection) {
                    welcomeSection.style.display = 'none';
                }

                // Clear the previously displayed post content
                const postDisplayArea = document.getElementById('postDisplayArea');
                postDisplayArea.innerHTML = '';

                // Display the 'Make a Post' form section
                const makepostSection = document.getElementById('makepostSection');
                makepostSection.style.display = 'block';
            });
        });
    
        // Function to display posts in the sidebar
        function displayPosts(filteredPosts = posts) {
            const postList = document.querySelector('.post-list');
            postList.innerHTML = ''; // Clear existing posts
    
            filteredPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.classList.add('sidebar-link');
                postElement.textContent = post.title;
                postElement.onclick = () => displayPostContent(post);
                postList.appendChild(postElement);
            });

        }
    
        // Function to display post content
        function displayPostContent(post) {
            const contentArea = document.getElementById('postDisplayArea');
            const postContent = `<h3>${post.title}</h3><p>${post.content}</p>`;
            
            // Add a textarea for comments
            const commentSection = `
                <div class="comment-section">
                    <textarea class="form-control" id="commentText" rows="2" placeholder="Add a comment..."></textarea>
                    <button class="btn btn-primary" id="postComment">Post Comment</button>
                </div>
            `;

            // Replace existing content in contentArea with the new post content
            contentArea.innerHTML = postContent + commentSection;

        // Add event listener to the Post Comment button
        document.getElementById('postComment').addEventListener('click', function() {
            postComment(post.title); // You might want to pass an identifier for the post
        });

            // Hide 'Make a Post' form section
            const makepostSection = document.getElementById('makepostSection');
            if (makepostSection) {
                makepostSection.style.display = 'none';
            }
            
            // Hide welcome section
            if (welcomeSection) {
                welcomeSection.style.display = 'none';
            }
        }

        // Initial display of all posts
        displayPosts(); 

        // Event listener for search functionality
        document.querySelector('.search-box').addEventListener('input', function(event) {
            const searchTerm = event.target.value.toLowerCase();
            const filteredPosts = posts.filter(post => post.title.toLowerCase().includes(searchTerm));
            displayPosts(filteredPosts);

        });

        function postComment(postTitle) {
            const commentText = document.getElementById('commentText').value;
            // Logic to handle the comment post
            // For example, send the comment to your server and then update the UI
            console.log("Comment on post", postTitle, ":", commentText);
            // Clear the comment textarea after posting
            document.getElementById('commentText').value = '';
        }

    </script>
    
</body>
</html>
